<!DOCTYPE html>
<html>
<head>
  <title>System Architecture and Directory Structure</title>
  <script src="https://cdn.jsdelivr.net/npm/d3@7.0.0/dist/d3.min.js"></script>
  <style>
    .node {
      cursor: pointer;
      fill: #999;
    }

    .node:hover {
      fill: #000;
    }

    .link {
      fill: none;
      stroke: #ccc;
      stroke-width: 1.5px;
    }
  </style>
</head>
<body>
  <div id="chart"></div>
  <script>
    // System Architecture
    var systemData = {
      "nodes": [
        {"id": "User", "type": "user"},
        {"id": "Nginx", "type": "server"},
        {"id": "Browser", "type": "client"},
        {"id": "NodeJS", "type": "server"},
        {"id": "GitHubAPI", "type": "api"},
        {"id": "D3", "type": "library"},
        {"id": "JQueryTerminal", "type": "library"},
        {"id": "LogFiles", "type": "storage"}
      ],
      "links": [
        {"source": "User", "target": "Nginx", "label": "HTTP Requests"},
        {"source": "Nginx", "target": "Browser", "label": "Serve Static Files"},
        {"source": "Nginx", "target": "NodeJS", "label": "Forward API Requests"},
        {"source": "NodeJS", "target": "GitHubAPI", "label": "Process Requests"},
        {"source": "NodeJS", "target": "D3", "label": "Send Data"},
        {"source": "NodeJS", "target": "JQueryTerminal", "label": "Send Data"},
        {"source": "D3", "target": "Browser", "label": "Render Data"},
        {"source": "JQueryTerminal", "target": "Browser", "label": "Display Terminal Interface"},
        {"source": "NodeJS", "target": "LogFiles", "label": "Store Logs"},
        {"source": "User", "target": "Browser", "label": "View & Interact"}
      ]
    };

    // Directory Structure
    var directoryData = {
      "name": "Root Directory",
      "children": [
        {"name": "css/", "children": [
          {"name": "style.css", "type": "file"}
        ]},
        {"name": "js/", "children": [
          {"name": "app.js", "type": "file"}
        ]},
        {"name": "lib/", "children": [
          {"name": "terminal.js", "type": "file"},
          {"name": "utils.js", "type": "file"}
        ]}
      ]
    };

    // Create the system architecture chart
    var systemWidth = 800;
    var systemHeight = 400;

    var systemSvg = d3.select("#chart")
      .append("svg")
      .attr("width", systemWidth)
      .attr("height", systemHeight);

    var systemSimulation = d3.forceSimulation(systemData.nodes)
      .force("link", d3.forceLink(systemData.links).distance(100))
      .force("charge", d3.forceManyBody().strength(-200))
      .force("center", d3.forceCenter(systemWidth / 2, systemHeight / 2));

    var systemLink = systemSvg.append("g")
      .attr("class", "links")
      .selectAll("line")
      .data(systemData.links)
      .enter().append("line")
      .attr("class", "link");

    var systemNode = systemSvg.append("g")
      .attr("class", "nodes")
      .selectAll("circle")
      .data(systemData.nodes)
      .enter().append("circle")
      .attr("class", "node")
      .attr("r", 10)
      .call(d3.drag()
        .on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended));

    systemNode.append("title")
      .text(function(d) { return d.id; });

    systemSimulation
      .on("tick", ticked);

    function ticked() {
      systemLink
        .attr("x1", function(d) { return d.source.x; })
        .attr("y1", function(d) { return d.source.y; })
        .attr("x2", function(d) { return d.target.x; })
        .attr("y2", function(d) { return d.target.y; });

      systemNode
        .attr("cx", function(d) { return d.x; })
        .attr("cy", function(d) { return d.y; });
    }

    function dragstarted(d) {
      if (!d3.event.active) systemSimulation.alphaTarget(0.3).restart();
      d.fx = d.x;
      d.fy = d.y;
    }

    function dragged(d) {
      d.fx = d3.event.x;
      d.fy = d3.event.y;
    }

    function dragended(d) {
      if (!d3.event.active) systemSimulation.alphaTarget(0);
      d.fx = null;
      d.fy = null;
    }

    // Create the directory structure chart
    var directoryWidth = 600;
    var directoryHeight = 400;

    var directorySvg = d3.select("#chart")
      .append("svg")
      .attr("width", directoryWidth)
      .attr("height", directoryHeight);

    var directoryTree = d3.tree()
      .size([directoryHeight, directoryWidth - 160]);

    var root = d3.hierarchy(directoryData);
    root.x0 = directoryHeight / 2;
    root.y0 = 0;

    update(root);

    function update(source) {
      var treeData = directoryTree(root);

      var nodes = treeData.descendants(),
          links = treeData.descendants().slice(1);

      // Nodes
      var node = directorySvg.selectAll("g.node")
        .data(nodes, function(d) { return d.id || (d.id = ++i); });

      var nodeEnter = node.enter().append("g")
        .attr("class", "node")
        .attr("transform", function(d) {
          return "translate(" + source.y0 + "," + source.x0 + ")";
        })
        .on("click", click);

      nodeEnter.append("circle")
        .attr("class", "node")
        .attr("r", 1e-6)
        .style("fill", function(d) {
          return d._children ? "lightsteelblue" : "#fff";
        });

      nodeEnter.append("text")
        .attr("dy", ".35em")
        .attr("x", function(d) {
          return d.children || d._children ? -13 : 13;
        })
        .attr("text-anchor", function(d) {
          return d.children || d._children ? "end" : "start";
        })
        .text(function(d) { return d.data.name; });

      // Links
      var link = directorySvg.selectAll("path.link")
        .data(links, function(d) { return d.id; });

      var linkEnter = link.enter().insert("path", "g")
        .attr("class", "link")
        .attr("d", function(d) {
          var o = {x: source.x0, y: source.y0};
          return diagonal(o, o);
        });

      // Transition nodes to their new position.
      var nodeUpdate = nodeEnter.merge(node);

      nodeUpdate.transition()
        .duration(750)
        .attr("transform", function(d) {
          return "translate(" + d.y + "," + d.x + ")";
        });

      nodeUpdate.select("circle")
        .attr("r", 4.5)
        .style("fill", function(d) {
          return d._children ? "lightsteelblue" : "#fff";
        });

      // Transition exiting nodes to the parent's new position.
      var nodeExit = node.exit().transition()
        .duration(750)
        .attr("transform", function(d) {
          return "translate(" + source.y + "," + source.x + ")";
        })
        .remove();

      nodeExit.select("circle")
        .attr("r", 1e-6);

      nodeExit.select("text")
        .style("fill-opacity", 1e-6);

      // Transition the links to their new position.
      link.transition()
        .duration(750)
        .attr("d", function(d) { return diagonal(d, d.parent); });

      // Stash the old positions for transition.
      root.each(function(d) {
        d.x0 = d.x;
        d.y0 = d.y;
      });
    }

    function diagonal(s, d) {
      return `M ${s.y} ${s.x}
              C ${(s.y + d.y) / 2} ${s.x},
                ${(s.y + d.y) / 2} ${d.x},
                ${d.y} ${d.x}`;
    }

    function click(d) {
      if (d.children) {
        d._children = d.children;
        d.children = null;
      } else {
        d.children = d._children;
        d._children = null;
      }
      update(d);
    }
  </script>
</body>
</html>
